# 13. 스코프

## 1) 스코프

- 스코프란, 변수의 유효 범위를 뜻한다.
- 변수가 선언되면, 선언된 위치에 의해 자신의 유효범위, 즉, 스코프가 결정된다.
- 이는 변수 뿐 아니라 모든 식별자(변수 이름, 함수 이름, 클래스 이름 등)가 가진다.
- 스코프는 다시말해, 식별자의 유효범위를 뜻한다.

```javascript
var x = "global";

function foo() {
  var x = "local";
  console.log(x); // (1)
}

foo();

console.log(x); // (2)
```

- 위와 같은 경우 자바스크립트 엔진은 1과 2에서 각각 어떤 x를 참조할 것인지 결정하는 **식별자 결정** 과정을 거친다.
- 자바스크립트 엔진은 스코프를 통해 어떤 변수 식별자를 참조할지 결정한다.
- 따라서 스코프는 식별자 검색 규칙이라고 볼 수 있다.
- 자바스크립트 엔진은 코드의 문맥을 고려하기 때문에, 코드의 문맥에 따라 위의 1과 2도 서로 다른 결과를 가진다.
- 위 두 x는 같은 식별자 이름을 가지지만 다른 스코프를 가진 서로 다른 변수다.
- 스코프의 개념이 없다면 같은 이름을 가진 변수는 서로 충돌을 일으킨다. 프로그램 전체에서 하나의 고유한 식별자만 존재해야 할것이다.
- 따라서 스코프로 인해 유효 범위가 정해진 덕분에 식별자의 충돌을 방지하며 같은 이름을 용도에 따라 쓸 수 있다.

## 2) 스코프 종류

- 스코프는 전역(global)과 지역(local)로 구분된다.
- 전역 스코프는 프로그램 내 어디에서나 참조가 가능하다.
- 지역 스코프는 해당 코드블록 내에서만 유효하다. 지역 스코프는 중첩이 가능하며 지역 스코프에 유효한 식별자는 그 하위 스코프에서도 유효하다. 하지만 역은 성립하지 않는다.

## 3) 스코프 체인

- 스코프가 하나의 계층 구조를 가지며 연결되는 것을 스코프 체인이라고 한다.
- 모든 스코프 체인의 최상위 스코프는 전역 스코프다.
- 변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 이용해서 실행된 코드의 스코프 부터 최상위 스코프까지 상위 방향으로 선언된 변수를 검색한다.
- 자바스크립트 엔진은 스코프 체인 구조를 렉시컬 환경으로 직접 생성하여 식별자를 조작한다.
- 하위 스코프에서는 상위의 식별자를 검색할 수 있지만 상위 스코프에서는 하위의 식별자를 검색할 수 없다.

## 4) 함수 레벨 스코프

- 자바스크립트는 기본적으로 코드블록 기반이 아닌 함수 기반으로 스코프를 생성해왔다.
- 따라서 var 키워드로 변수 선언 시 함수 레벨의 스코프가 정의된다.
- ES6 이후 정의된 let, const는 보편적인 언어와 같이 블록 레벨 스코프를 가진다.

## 5) 렉시컬 스코프

- 식별자를 호출할 때 스코프를 결정하는 경우를 동적 스코프라고 한다.
- 식별자를 정의할 때 스코프를 결정하는 경우를 렉시컬 스코프 또는 정적 스코프라고 한다.
- 자바스크립트는 식별자의 정의 위치에 따라 스코프를 결정하는 렉시컬 스코프를 따른다.
- 함수의 상위 스코프는 함수가 정의될 때 정적으로 결정된다.
